(function(){"use strict";const p=o=>{const t=(o.widths||[]).map(e=>Math.floor(e)).filter(e=>Number.isFinite(e)&&e>0&&e<=o.sourceWidth);return t.length===0?[Math.max(1,Math.floor(o.sourceWidth))]:Array.from(new Set(t)).sort((e,i)=>e-i)},w=async o=>{const t=Math.min(1,Math.max(.1,o.quality));if(o.preferWebp)try{const i=await o.canvas.convertToBlob({type:"image/webp",quality:t});if(i&&i.size>0)return{blob:i,mimeType:"image/webp"}}catch{}return{blob:await o.canvas.convertToBlob({type:"image/jpeg",quality:t}),mimeType:"image/jpeg"}};self.onmessage=o=>{(async()=>{const t=o.data,e=Math.max(1,Math.min(8192,Math.floor(t.maxCanvasDimension||4096))),i=t.preferWebp!==!1,u=typeof t.quality=="number"?t.quality:.82;if(typeof self.createImageBitmap!="function"){self.postMessage({ok:!1,error:"createImageBitmap not supported"});return}const r=await self.createImageBitmap(t.blob,{imageOrientation:"from-image"}),h=r.width,m=r.height,n=(()=>{const a=Math.max(h,m);if(a<=e)return{width:h,height:m,wasConstrained:!1};const s=e/a;return{width:Math.floor(h*s),height:Math.floor(m*s),wasConstrained:!0}})(),b=p({widths:t.widths,sourceWidth:n.width});let c=r;if(n.wasConstrained){const a=new OffscreenCanvas(n.width,n.height),s=a.getContext("2d");if(!s)throw new Error("Unable to get canvas context");s.drawImage(r,0,0,n.width,n.height),c=a.transferToImageBitmap(),r.close()}const f=[];for(const a of b){const s=Math.max(1,Math.round(c.height*a/c.width));if(Math.max(a,s)>e)continue;const g=new OffscreenCanvas(a,s),d=g.getContext("2d");if(!d)continue;d.drawImage(c,0,0,a,s);const l=await w({canvas:g,preferWebp:i,quality:u});f.push({targetWidth:a,targetHeight:s,mimeType:l.mimeType,blob:l.blob})}c.close();const M={sourceWidth:h,sourceHeight:m,constrainedWidth:n.width,constrainedHeight:n.height,wasConstrained:n.wasConstrained,variants:f};self.postMessage({ok:!0,result:M})})().catch(t=>{self.postMessage({ok:!1,error:t?.message||"Worker failed"})})}})();
//# sourceMappingURL=imageVariantWorker-CKZ81EDv.js.map
